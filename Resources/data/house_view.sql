DROP VIEW IF EXISTS `house_view`;
CREATE VIEW `house_view` AS
SELECT
	r.house_id,
	r.room_id as record_id,
	r.occupancy_number,
	r.detain,
	r.pay,
	r.gender_restrictions,
	r.status,
	r.room_type,
	r.is_yytz,
	r.is_yd,
	r.money,
	CONCAT(h.house_name,IF(r.room_type = 'main','主卧',IF(r.room_type = 'guest','客卧','次卧')),r.custom_number,'号') as house_name,
	h.rental_way,
	c.city_id,
	c.area_id,
	h.community_id,
	c.community_name,
	CONCAT(h.custom_number,'-',r.custom_number) as custom_number,
	h.cost,
	h.unit,
	h.number,
	h.`count`,
	h.hall,
	h.toilet,
	r.area,
	h.total_floor,
	h.floor,
	h.public_facilities,
	c.address,
	r.create_time,
	r.update_time,
	h.company_id,
	h.create_uid,
	if(r.is_delete = 1,r.is_delete,h.is_delete) as is_delete,
	h.owner_id
FROM room as r
JOIN house as h on r.house_id = h.house_id
JOIN community as c on h.community_id = c.community_id
WHERE (h.rental_way = 1)
UNION ALL
SELECT
	he.house_id,
	0 as record_id,
	he.occupancy_number,
	he.detain,
	he.pay,
	he.gender_restrictions,
	he.status,
	'' as room_type,
	he.is_yytz,
	he.is_yd,
	he.money,
	h.house_name,
	h.rental_way,
	c.city_id,
	c.area_id,
	h.community_id,
	c.community_name,
	h.custom_number,
	h.cost,
	h.unit,
	h.number,
	h.`count`,
	h.hall,
	h.toilet,
	h.area,
	h.total_floor,
	h.floor,
	h.public_facilities,
	c.address,
	h.create_time,
	h.update_time,
	h.company_id,
	h.create_uid,
	if(he.is_delete = 1,he.is_delete,h.is_delete) as is_delete,
	h.owner_id
FROM house_entirel as he
JOIN house as h on he.house_id = h.house_id
JOIN community as c on h.community_id = c.community_id
WHERE (h.rental_way = 2);