DROP VIEW IF EXISTS `house_focus_view`;
CREATE VIEW `house_focus_view` AS
SELECT
	r.house_id,
	r.room_id AS record_id,
	r.occupancy_number,
	r.detain,
	r.pay,
	r.gender_restrictions,
	r.status,
	r.is_yytz,
	r.is_yd,
	r.money,
	CONCAT(h.house_name,IF(r.room_type = 'main','主卧',IF(r.room_type = 'guest','客卧','次卧')),r.custom_number,'号') as house_name,
	h.rental_way,
	c.city_id,
	c.area_id,
	h.community_id,
	CONCAT(h.custom_number,'-',r.custom_number) AS custom_number,
	h.cost,
	h.unit,
	h.number,
	h.`count`,
	h.toilet,
	r.area,
	h.total_floor,
	h.floor,
	h.public_facilities,
	c.address,
	r.create_time,
	r.update_time,
	h.company_id,
	h.create_uid,
	if(r.is_delete = 1,r.is_delete,h.is_delete) as is_delete,
	h.owner_id,
	c.community_id as auth_id,
	r.is_hide,
	r.is_top,
	r.is_best,
	r.attachments_cover
FROM room AS r
JOIN house AS h ON r.house_id = h.house_id
JOIN community AS c ON h.community_id = c.community_id
WHERE (h.rental_way = 1)
UNION ALL
SELECT
	he.house_id,
	0 AS record_id,
	he.occupancy_number,
	he.detain,
	he.pay,
	he.gender_restrictions,
	he.status,
	he.is_yytz,
	he.is_yd,
	he.money,
	h.house_name,
	h.rental_way,
	c.city_id,
	c.area_id,
	h.community_id,
	h.custom_number,
	h.cost,
	h.unit,
	h.number,
	h.`count`,
	h.toilet,
	h.area,
	h.total_floor,
	h.floor,
	h.public_facilities,
	c.address,
	h.create_time,
	h.update_time,
	h.company_id,
	h.create_uid,
	if(he.is_delete = 1,he.is_delete,h.is_delete) as is_delete,
	h.owner_id,
	c.community_id as auth_id,
	h.is_hide,
	h.is_top,
	h.is_best,
	h.attachments_cover
FROM house_entirel AS he
JOIN house AS h ON he.house_id = h.house_id
JOIN community AS c ON h.community_id = c.community_id
WHERE (h.rental_way = 2)
UNION ALL
SELECT
	0 AS house_id,
	rf.room_focus_id AS record_id,
	rf.custom_number AS occupancy_number,
	rf.detain,
	rf.pay,
	0 AS gender_restrictions,
	rf.status,
	rf.is_yytz,
	rf.is_yd,
	rf.money,
	CONCAT(f.flat_name,rf.floor,'楼',rf.custom_number,'号') AS house_name,
	f.rental_way,
	f.city_id,
	f.area_id,
	0 AS community_id,
	rf.custom_number,
	0 AS cost,
	0 AS unit,
	0 AS number,
	SUBSTRING_INDEX(rf.room_type,'t',1) AS `count`,
	SUBSTRING_INDEX(rf.room_type,'t',-1) AS toilet,
	rf.area,
	0 AS total_floor,
	0 AS floor,
	rf.room_config AS public_facilities,
	f.address,
	rf.create_time,
	rf.create_time AS update_time,
	rf.company_id,
	rf.create_uid,
	if(rf.is_delete = 1,rf.is_delete,f.is_delete) as is_delete,
	rf.owner_id,
	f.flat_id as auth_id,
	rf.is_hide,
	rf.is_top,
	rf.is_best,
	rf.attachments_cover
FROM room_focus AS rf
JOIN flat AS f ON rf.flat_id = f.flat_id;