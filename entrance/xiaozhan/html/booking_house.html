<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="apple-touch-fullscreen" content="YES">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta http-equiv="Expires" content="-1">
		<meta http-equiv="pragram" content="no-cache">
		<meta name="viewport" content="width=640, user-scalable=no">
		<title>预约看房</title>
		<link rel="stylesheet" type="text/css" href="../css/base.css"/>
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	</head>
	<body>
		<div class="main">
			
			<nav id="nav">
				<a href="javascript:history.go(-1)" class="btn back"><em></em><span>返回</span></a>
				<h1>预约看房</h1>
			</nav>
			
			<h4 class="subscribe-title">为方便我们尽快联系到您，请填写真实信息。</h4>
			<div class="subscribe-content">
            	<form method="" action="" id="js_booking_fm">
                    <dl>
                        <dd>
                            <div class="gender">
                                <div class="rounded-radio">
                                    <input id="gender-1" type="radio" value="1" name="gender" />
                                    <label for="gender-1"></label>
                                </div>
                                <label for="gender-1">汉子</label>
                            </div>
                            
                            <div class="gender">
                                <div class="rounded-radio">
                                    <input id="gender-2" type="radio" value="2" name="gender" />
                                    <label for="gender-2"></label>
                                </div>
                                <label for="gender-2">妹子</label>
                            </div>
                        </dd>
                        <dd>
                            <input type="text" name="us-name" id="us-name" class="inp-long" placeholder="姓名"/>
                        </dd>
                        <dd>
                            <input type="text" name="us-tel" id="us-tel" class="inp-long" placeholder="电话"/>
                        </dd>
                        <dd>
                            <input type="text" name="data-dtm" id="data-dtm" class="fl inp-short" placeholder="动态码"/>
                            <a href="javascript:;" class="get-dtm fr">获取动态码</a>
                        </dd>
                        <dd>
                            <input type="text" name="us-time" id="us-time" class="inp-long" placeholder="看房时间" disabled/>
                        </dd>
                        <dd>
                            <textarea name="remark" id="remark" placeholder="备注"></textarea>
                        </dd>
                    </dl>
                    <div class="form-submit">
                        <input type="button" id="js_booking_btn" class="btn" value="提交信息" />
                    </div>
                </form>
		</div>
	</body>
    <script type="text/javascript" src="../js/zepto.min.js"></script>
		<script type="text/javascript" src="../js/base.js"></script>
        <script>
        
            L.bookingHouse = {
                //基础验证
                verification:function(){
					$('#js_booking_btn').on('click',function(){
						var parm = {},
							gender = $("#js_booking_fm input[name='gender']:checked").val(),//性别
							uName = $('#us-name'), //姓名
							uPhone = $('#us-tel'), //电话
							uCode = $('#data-dtm'), //动态码
							uRemarks = $('#remark'); //备注信息
						if(gender == undefined){
							L.dialog._create({
								msg:'请选择您的性别,方便房东与您联系'
							});
						}else if( $.trim( uName.val() ) == ''){
							L.dialog._create({
								msg:'请输入您的姓名,方便房东与您联系',
								callback:function(){
									uName.focus();
								}
							});
						}else if( $.trim( uPhone.val() ).length != 11 ){
							L.dialog._create({
								msg:'请输入正确的手机号码',
								callback:function(){
									uPhone.focus();
								}
							});
						}else if( $.trim( uCode.val() )  == '' ){
							L.dialog._create({
								msg:'请输入您手机收到的动态码',
								callback:function(){
									uCode.focus();
								}
							});
						}else{
							//参数集合
							parm.houseId = '1'; // ---- 后端配置
							parm.gender = gender;
							parm.uName = uName.val();
							parm.uPhone = uPhone.val();
							parm.uCode = uCode.val();
							parm.uRemarks = uRemarks.val() ;
							//提交数据
							$.ajax({
								type: 'GET', 
								url: '?.php?r=' + Math.random(1000), // ---- 后端配置url
								data: parm,
								dataType: 'json',
								timeout:300,
								success: function(data){
									if(data.status == 1){ //预约成功
										L.dialog._create({
											msg:'您的预约已经提交成功，请耐心等待，我们正在委派业务专员为您服务.',
											callback:function(){
												uName.val('');
												uPhone.val('');
												uCode.val('');
												uRemarks.val('') ;
											}
										});
									}else{ //预约失败
										L.dialog._create({
											msg:'出错了，请重新提交.'
										});
									}
								},
								error: function(xhr, type){
									L.dialog._create({
										msg:'出错了，请重试.'
									});
									return false;
								}
							});	
						}
					});	
				},
				//获取注册动态码
				getDynamicCode:function(){
					$('#js_booking_fm .get-dtm').on('click',function(){
						var phone = $('#us-tel'),
							_this=$(this),
							timer = null;
						if( $.trim( phone.val() ) == '' ||  $.trim(phone.val()).length != 11 ){
							L.dialog._create({
								msg:'请输入正确的手机号码',
								callback:function(){
									phone.focus();
								}	
							});
						}else{
							$.ajax({
								type: 'GET', 
								url: '', //请求地址
								data: { phone: '' }, //参数
								dataType: 'json',
								timeout:300,
								success: function(data){
									//这里还需要判断data....
									
									//如果一切正常，执行下面的代码
									_this.text('60'+'S');
									var num = parseInt(_this.text());
									timer = setInterval(function(){
										if(num > 1){
											num--;
											_this.text(num +'S');
										}else{
											_this.text('重新发送');
											clearInterval(timer);
										}
									},1000);
								},
								error: function(xhr, type){
									L.dialog._create({
										msg:'出错了，请重试.'
									});
									return false;
								}
								
							});	
						}
					});
				},
                init:function(){
                   	this.verification();
					this.getDynamicCode();
                }	
            }
            $(document).ready(function(e) {
                L.bookingHouse.init();
            });
        </script>
</html>
</html>
