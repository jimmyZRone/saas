<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="apple-touch-fullscreen" content="YES">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta http-equiv="Expires" content="-1">
		<meta http-equiv="pragram" content="no-cache">
		<meta name="viewport" content="width=640, user-scalable=no">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>选择验证方式</title>
		<link rel="stylesheet" type="text/css" href="../css/base.css"/>
		<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	</head>
	<body>
		<div class="main">
			<nav id="nav">
				<a href="javascript:history.go(-1)" class="btn back"><em></em><span>返回</span></a>
				<h1>选择验证方式</h1>
			</nav>
			
			<h4 class="register-title"></h4>
			<div class="register-content">
            	<form action="set_pass.html" method="post" id="js_sele_verif_fm">
                    <ul>
                        <li>
                            <input type="text" class="ipt-short" readonly value="15884585827" />
                            <a href="#" class="getDtm">获取动态码</a>
                        </li>
                        <li>
                            <input type="text" class="ipt" id="code" placeholder="请输入手机短信中的验证码"/>
                        </li>
                    </ul>
                    
                    <div class="submitForm">
                        <input type="submit" value="验证" class="sub-btn" />
                    </div>
                </form>
			</div>
			<footer>
				<p class="fl">&copy;九猪<span class="p">版权所有</span></p>
				<p class="fr"><a href="#"><i></i>申请小站</a></p>
			</footer>
		</div>
	</body>
    <script type="text/javascript" src="../js/zepto.min.js"></script>
    <script type="text/javascript" src="../js/base.js"></script>
    <script>
		L.selectVerif = {
			//基础验证
			verification:function(){
				$('#js_sele_verif_fm').on('submit',function(){
					var code = $('#code');
					if( $.trim( code.val() ) == ''){
						L.dialog._create({
							msg:'请输入手机短信中的验证码',
							callback:function(){
								code.focus();
							}
						});
						return false;
					}else{
						return true;
					}
				});				
			},
			//倒计时效果
			countDown:function(obj){
				obj.text('60'+'S');
				var num = parseInt( obj.text() );
				timer = setInterval( function(){
					if(num > 1){
						num--;
						obj.text(num +'S');
					}else{
						obj.text('重新发送');
						clearInterval(timer);
					}
				},1000 );
			},
			
			//获取注册动态码
			getDynamicCode:function(){
				var ele = $('#js_sele_verif_fm .getDtm');
				L.selectVerif.countDown( ele );  //首次页面触发，其实后端已经给用户手机发短信了...
				ele.on('click',function(){
					var _this = $(this),
						timer = null,
						txt = _this.text();
					if( txt == '重新发送' ){
						$.ajax({
							type: 'GET', 
							url: '', //请求地址
							data: { phone: '' }, //参数
							dataType: 'json',
							timeout:300,
							success: function(data){
								//这里还需要判断data....
								
								
								//如果一切正常，执行下面的代码
								L.selectVerif.countDown( _this );
							},
							error: function(xhr, type){
								L.dialog._create({
									msg:'出错了，请重试.'
								});
								return false;
							}
						});	
					}
				});
			},
			//统一初始化
			init:function(){
				this.verification();
				this.getDynamicCode();
			}	
		}
    	$(document).ready(function(e) {
            L.selectVerif.init();
        });
    </script>

</html>
